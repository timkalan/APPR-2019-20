---
title: "Poročilo pri predmetu Analiza podatkov s programom R - Migracija po svetu"
author: "Tim Kalan"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
# runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Spodaj je prikazanih nekaj podatkov o migraciji po svetu. Zajeta je večina svetovnih držav (za nekatere enostavno
ni vseh podatkov) in obdobje od leta 1960 do 2010 (razpon podatkov o migraciji).

![](slike/migracija.jpg)

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozili smo podatke o migraciji, populaciji, religiji in izobrazbi v obliki CSV iz raznih spletnih strani (navedenih v README-ju), 
poleg tega pa še podatke o BDP-ju držav skozi čas v obliki HTML iz Wikipedije. Podatke imamo v dveh razpredelnicah v 
obliki *tidy data*. 

<!-- 1. `poSpolih` - podatki o migraciji ljudi -->
<!--   - `origin_country` - spremenljivka: ime države, iz katere so se ljudje izseljevali (besedilo), -->
<!--   - `dest_country` - spremenljivka: ime države, v katero so se ljudje vseljevali (besedilo), -->
<!--   - `gender` - spremenljivka: spol izseljenca (oz. priseljenca) (besedilo), -->
<!--   - `decade` - spremenljivka: desetletje, v katerem se je preseljevanje dogajalo (besedilo), -->
<!--   - `number` - meritev: število ljudi, ki se je preselilo iz origin v dest v desetletju decade (število: med 0 in 5200000). -->
  
1. `migranti` - podatki o migraciji ljudi
  - `origin` - spremenljivka: ime države, iz katere so se ljudje izseljevali (besedilo),
  - `destination` - spremenljivka: ime države, v katero so se ljudje vseljevali (besedilo),
  - `year` - spremenljivka: leto, v katerem je bila izmerjena migracija (število: med 1990 in 2019, petletni intervali),
  - `number` - meritev: število ljudi, ki se je preselilo iz origin v destination v določenem letu (število).

2. `stock` - podatki o številu migrantov v posamezni državi
  - `country` - spremenljivka: ime države (besedilo),
  - `year` - spremenljivka: leto, na kateregea se podatek navezuje (število: med 1990 in 2019, ustrezno leto),
  - `age` - spremenljivka: starostna skupina (besedilo: petletne skupine),
  - `gender` - spremenljivka: spol imigranta (besedilo: male ali female),
  - `number` - meritev: število imigrantov (število).

3. `drzave` - podatki o skoraj vseh svetovnih državah
  - `drzava` - spremenljivka: ime države (besedilo),
  - `leto` - spremenljivka: leto, na kateregea se podatek navezuje (število: med 1990 in 2019, ustrezno leto),
  - `BDP` - meritev: bruto domači proizvod, prilagojen na cene (število: med 0 in 28000000000 v dolarjih),
  - `populacija` - meritev: populacija posamezne države (oz. ocena, kjer točna vrednost ni na voljo) (število),
  - `izobrazba` - meritev: indeks izobraženosti za posamezne države (število: med 0 in 1), 
  - `hdi` - meritev: indeks človekove razvitosti za posamezne države (število: med 0 in 1).
  
4. `religije` - podatki o verski strukturi posameznih držav
  - `country` - spremenljivka: ime države (besedilo),
  - `christians` - meritev: število kristjanov v državi (število),
  - `muslims` - meritev: število muslimanov v državi (število),
  - `unaffiliated` - meritev: število nevernikov (ateistov) v državi (število),
  - `hindus` - meritev: število hinduistov v državi (število),
  - `buddhists` - meritev: število budistov v državi (število),
  - `folkReligions` - meritev: število pripadikov neki lokalni veri v državi (število),
  - `other` - meritev: število pripadnikov drugim religijam v državi (število),
  - `jews` - meritev: število judov v državi (število).

**Opomba**: Tabela `drzave` ni v *tidy data*, saj je BDP na prebivalca veliko bolj relevantana metrika, a je
            izpeljana iz stolpcev `BDP` in `populacija`. 
            HDI (human development index) je indeks, ki združuje izobazbo (pričakovano število let šolanja), BDP na
            prebivalca in pričakovano življenjsko dobo. Povzame razvitost države.


Spodnji graf prikazuje migracijo v sloveniji v zadnjih petdesetih letih (placeholder?).

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Slovenska migracija'}
# sloIZ <- poSpolih %>% filter(origin_country == "Slovenia") %>% select(-"origin_country") %>%
#   group_by(gender, decade) %>% summarise(izselitev = sum(number, na.rm = TRUE))
# sloV <- poSpolih %>% filter(dest_country == "Slovenia") %>% select(-"dest_country") %>%
#   group_by(gender, decade) %>% summarise(vselitev = sum(number, na.rm = TRUE))
# svn <- inner_join(sloIZ, sloV, by = c("gender", "decade"))
# svn$izselitev <- svn$izselitev * (-1)
# ggplot(svn, aes(x = decade, y = vselitev, fill = gender)) + 
#   geom_bar(stat = "identity", position=position_dodge(), color = "black") + 
#   geom_bar(aes(x = decade, y = izselitev), stat = "identity", position=position_dodge(), color = "black") +
#   xlab("Desetletje") + ylab("izselitev/vselitev")
  
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
source("analiza/analiza.r", encoding="UTF-8")
```

Graf prikazuje povezavo med BDP-jem države in število priseljencev (skupno), ker pa ni moč opaziti
močne korelacije, bo po vsej verjetnosti zamenjan.

```{r graf, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
starostLeta
grafBdp
```

Spodnji zemljevid prikazuje države, razvrščene po deležu priseljencev glede na celotno populacijo leta 2018.

```{r zemljevid, echo=FALSE, warning=FALSE, message=FALSE, results='hide', fig.align='center', fig.cap='Zemljevid deleža priseljencev'}
zemStock
zemCluster
```

***
