---
title: "Migracija po svetu"
author: "Tim Kalan"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Nekaj o temi

Spodaj je prikazanih nekaj podatkov o migraciji po svetu. Zajeta je velika večina svetovnih držav, 
za vse podatke vsaj 180. Razlog, da ni vseh je enostavno to, da ni podatkov za njih. Opazovali smo 
časovno obdobje med letom 1990 in 2019.

![](slike/migracija.jpg)

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozili smo podatke o emigraciji in imigraciji, populaciji, verski strukturi, izobrazbi in indeksu človekovega razvoja
v obliki CSV iz raznih spletnih strani, ki so natančno navedene v "README.md", 
poleg tega pa še podatke o BDP-ju držav skozi čas v obliki HTML iz Wikipedije. Podatke imamo v štirih razpredelnicah v 
obliki *tidy data*. 
  
1. `migranti` - podatki o migraciji ljudi
  - `origin` - spremenljivka: ime države, iz katere so se ljudje izseljevali (besedilo),
  - `destination` - spremenljivka: ime države, v katero so se ljudje vseljevali (besedilo),
  - `year` - spremenljivka: leto, v katerem je bila izmerjena migracija (število: med 1990 in 2019, petletni intervali),
  - `number` - meritev: število ljudi, ki se je preselilo iz origin v destination v določenem letu (število).

2. `stock` - podatki o številu migrantov v posamezni državi
  - `country` - spremenljivka: ime države (besedilo),
  - `year` - spremenljivka: leto, na kateregea se podatek navezuje (število: med 1990 in 2019, ustrezno leto),
  - `age` - spremenljivka: starostna skupina (besedilo: petletne skupine),
  - `gender` - spremenljivka: spol imigranta (besedilo: male ali female),
  - `number` - meritev: število imigrantov (število).

3. `drzave` - podatki o skoraj vseh svetovnih državah
  - `drzava` - spremenljivka: ime države (besedilo),
  - `leto` - spremenljivka: leto, na kateregea se podatek navezuje (število: med 1990 in 2019, ustrezno leto),
  - `BDP` - meritev: bruto domači proizvod, prilagojen na cene (število: med 0 in 28000000000 v dolarjih),
  - `populacija` - meritev: populacija posamezne države (oz. ocena, kjer točna vrednost ni na voljo) (število),
  - `izobrazba` - meritev: indeks izobraženosti za posamezne države (število: med 0 in 1), 
  - `hdi` - meritev: indeks človekove razvitosti za posamezne države (število: med 0 in 1).
  
4. `religije` - podatki o verski strukturi posameznih držav
  - `country` - spremenljivka: ime države (besedilo),
  - `christians` - meritev: število kristjanov v državi (število),
  - `muslims` - meritev: število muslimanov v državi (število),
  - `unaffiliated` - meritev: število nevernikov (ateistov) v državi (število),
  - `hindus` - meritev: število hinduistov v državi (število),
  - `buddhists` - meritev: število budistov v državi (število),
  - `folkReligions` - meritev: število pripadikov neki lokalni veri v državi (število),
  - `other` - meritev: število pripadnikov drugim religijam v državi (število),
  - `jews` - meritev: število judov v državi (število).

**Opomba**: Tabela `drzave` ni v *tidy data*, saj je BDP na prebivalca izpeljana iz stolpcev `BDP` in `populacija`.
            Obdržali smo jo v tabeli, ker je veliko bolj relevantna metrika, kot BDP.
            HDI (human development index) je indeks, ki združuje izobazbo (pričakovano število let šolanja), BDP na
            prebivalca in pričakovano življenjsko dobo. Povzame razvitost države.

***

# Zaloga migrantov (migrant stock)

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
source("analiza/analiza.r", encoding="UTF-8")
```

Graf prikazuje količino vseh svetovnih migrantov v opazovanem obdobju, razdeljenih glede na starost, 
škatla pa dodatno pove, kako se je to število spreminjalo skozi leta.

```{r graf, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
starostLeta
```

Opazimo, da je največ priseljencev starih med 30 in 40 let, hkrati pa se je njihova količina tudi najbolj
spreminjala. Število migrantov vseh starosti je skozi obdobje rastlo. Sklepamo, da je najstarejših migrantov 
nenavadno več od malce mlajših, ker je v njihopvo skupino zajeto več možnih starosti.

V nadaljevanju smo si ogledali, kakšen delež populacije posamezne države predstavljajo migranti, nato pa smo 
države še razdelili v skupine in opazili vsaj delno ujemanje. Prikazano je na spodnjih zemljevidih.

```{r zemljevid, echo=FALSE, warning=FALSE, message=FALSE, results='hide', fig.align='center', fig.cap='Zemljevid deleža priseljencev'}
zemStock
```

```{r cluster, echo=FALSE, warning=FALSE, message=FALSE, results='hide', fig.align='center', fig.cap='Države po skupinah'}
zemCluster
```

Ker je veliko držav z relativno majhnim deležem priseljencev, so bile na prvem zemljevidu dane v isto 
kategorijo, medtem ko je R skozi *clustering* te skupine izbral bolj pametno.

***

# Migracija in religije

```{r bar, plotly = TRUE, echo=FALSE, warning=FALSE, message=FALSE}
grafDrreg
```

V zgornjem grafu (če se z miško sprehodimo čez stolpce, lahko vidimo državo) so predstavljeni podatki o deležih imigracije in emigracije po 
posameznih državah glede na velikost prebivalstva, urejenih po dominantni religiji v državi. 
O točnosti podatkov seveda ne moremo govoriti (morda je skoraj 200% priselitev ljudi v Papuo Novo Gvinejo malce pretirano), a vseeno lahko 
opazimo nekatere zanimivosti: 

* Čeprav je držav v posamezni kategoriji zelo različno, so znotraj skupin povsod približno enako urejene (nekaj visokih stolpcev, ki eksponentno
  padajo).
* Največji delež imigranotv so dosegle države, ki so večinoma muslimanske. Ob natančnejšem pregledu dejanskih držav, bi lahko sklepali, da so te 
  države postale muslimanske prav zaradi priseljevanja muslimanov, saj se drugače ne zdijo pretirano muslimanske (to so nekatere države v južni 
  Ameriki).
* Vse verske skupine so imele več imigracije kot emigracije, kar je verjetno posledica napake v podatkih.


***

```{r shiny, echo=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```

Iz zgornjega interaktivnega grafa lahko opazimo močno korelacijo med imigracijo oz. emigracijo in BDP-jem 
države. Ob natančnem pregledu in primerjavo z BDP per capita in populacijo opazimo, da je ta povezava 
posledica naraščanja populacije in ne zares efektivnega BDP.

***